<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta charset="UTF-8">
    
    <!-- Main Docsify Stylesheet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css" title="style::Simple">

    <!-- Alternate Docsify Stylesheet -->
    <link rel="stylesheet alternate" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css" title="style::Simple Dark">
    <link rel="stylesheet alternate" href="https://unpkg.com/docsify@4.9.4/themes/vue.css" title="style::Vue">
    <link rel="stylesheet alternate" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-defaults.css" title="style::Plain">

    <!-- Manual style override -->
    <link rel="stylesheet" type="text/css" href="asset/custom.css" />
    <link rel="stylesheet alternate" href="asset/custom-dark.css" title="style::Simple Dark"/>
    <link rel="stylesheet" type="text/css" href="asset/mini-collapsible.css" />
    <title>Midtrans Alt Docs</title>
</head>

<body>
    <div id="app"></div>
    <script>
        // Main Docsify setup
        window.$docsify = {
            logo: 'asset/image/main/midtrans-logo.svg',
            loadSidebar: true,
            loadNavbar: true,
            name: 'Midtrans Docs',
            // themeColor: '#3F51B5',
            homepage: 'en/home.md',
            // repo: 'https://github.com/rizdaprasetya/mt-alt-doc/',
            // basePath: "/",
            alias: {
                // proxy for any /gh/ url to fetch markdown from real github url
                '.*?/gh/(.*)': 'https://raw.githubusercontent.com/$1',
                /**
                 * Based on https://docsify.js.org/#/more-pages?id=nested-sidebars
                 * Custom override to force rewrite any request to `[subfolder]/_sidebar.md` 
                 * to `[root folder]/_sidebar.md``
                 * Problem: 
                 * Prevent unnecessary fallback.
                 * If docs is located on subfolder, on page load Docsify tried to fetch 
                 * `[subfolder]/_sidebar.md`, if not exist then slowly move up to root.
                 * which can be slow to wait for 404 call. It impacted UI to be seem 
                 * unresponsive for few second on prod
                 */
                '/en/.*/_sidebar.md': '/_sidebar.md',
                '/en/.*/_navbar.md': '/_navbar.md'
            },
            search: {
                // set to 1 hour on development, change to 1 day on prod
                maxAge: 1000*1*60*60, 
                depth: 6,
                noData: 'No results!',
                placeholder: 'Search...'
            },
            routerMode: 'hash',
            auto2top: true,
            maxLevel: 3,
            subMaxLevel: 3,
            plugins: [
                /**
                 * Custom plugin to replace all wrong sidebar image path
                 * So it point to right asset directory
                 * @HACK: Not extensively tested on and might broke on sub path, e.g: example.com/sub/path/
                 */
                function (hook, vm) {
                    hook.doneEach(function(){
                        // @HACK: use $docsify.logo as assetPath source, use hard coded .svg extension
                        // might break when $docsify.logo is changed.
                        let assetPath = window.$docsify.logo.replace(/(.*)\/.*?\.svg/g,"$1/");
                        // all sidebar img tag
                        document
                            .querySelectorAll(`.sidebar-nav ul>li>strong>img`)
                            .forEach(function(el){
                                // filter out element that have '.emoji' class
                                if(el.classList.length > 0){
                                    return;
                                }
                                el.src = el.src
                                    .replace(/.*?\/asset\/image\/main\/(.*)/g,assetPath+"$1");
                            })


                    })
                },
                /**
                 * Custom plugin to replace all relative URL with absolute
                 * So when crawled, asset links are not broken
                 * @HACK: Not tested on and might broke on sub path, e.g: example.com/sub/path/
                 */
                function (hook, vm) {
                    hook.ready(function(){
                        const isPluginActivated = true
                        if (!isPluginActivated){
                            return false
                        }
                        // url in these attribute will be replaced
                        const attributeQueries = [
                            'href',
                            'src'
                        ]
                        const httpPrefix = 'http'
                        // loop all attribute
                        attributeQueries.map(function(attr){
                            // query all element with the attribute
                            let elementFound = Array.from(document.querySelectorAll('['+attr+']'))
                            elementFound.map(function(el){
                                // if url doesn't start with http prefix, replace with absolute url
                                if( (el[attr].toLocaleLowerCase()).startsWith(httpPrefix) ){
                                    let newUrl = new URL(el[attr], document.location.href)
                                    el[attr] = newUrl.href
                                }
                            })

                        })
                    })
                },
                /**
                 * custom plugin to replace various relative url to point to 
                 * proper github repo url
                 * @NOTE: looks like unused, because no sidebar refer to ext repo
                 */
                function (hook, vm) {
                    hook.beforeEach(function (rawMarkdown) {
                        let modifiedMarkdown = rawMarkdown
                        // only apply changes if the file is fetched from github
                        if (/githubusercontent\.com/.test(vm.route.file)){
                            let currentFileUrl = (vm.route.file).toLowerCase()
                            let currentFileRepoUrl = 
                                currentFileUrl
                                    .replace('raw.githubusercontent.com','github.com')
                                    .replace('/master/','/tree/master/')
                                    .split('readme.md')[0]
                            // replace (example/) to (/example/), to make it consistent
                            modifiedMarkdown = modifiedMarkdown.replace(/\]\(example/g,"\]\(/example")
                            // replace relative /.. urls to absolute github urls
                            modifiedMarkdown = modifiedMarkdown.replace(/\]\(\/(.*)\)/g, "]("+currentFileRepoUrl+"$1)")
                            // replace #(begin with number) to #_ to make hash url work on docsify
                            modifiedMarkdown = modifiedMarkdown.replace(/\]\(\#([0-9].*)\)/g," ](#_$1)")
                            // Add prefix text to link to original repo url
                            modifiedMarkdown = '> Note: [Click to visit the project Repository]('+currentFileRepoUrl+')\n' + modifiedMarkdown
                        }
                        return modifiedMarkdown
                    })
                },
                /**
                 * Custom plugin to fix scrolling issue.
                 * Docsify have scrolling issue on page load of a page with image.
                 * https://github.com/docsifyjs/docsify/issues/351
                 * This will ensure scroll to element id based on id found on url.
                 * @HACK: 
                 * - it use constant delay of 2 sec, then scroll, what if page load
                 * more than 2 sec?
                 */
                function (hook, vm) {
                    hook.doneEach(function () {
                        // true = show debug log
                        let dd = false 
                        let TARGET_QUERY = 'id'
                        let SCROLL_DELAY = 2000 // in milisecond
                        let location = window.location
                        let isBrowserTabFocused = !document.hidden
                        let browserTabFocusedCount = 0

                        dd&&console.log('custom scroll plugin called!')
                        let currentUrlWithoutHash = new URL(
                            location.origin+location.pathname+
                            location.search+location.hash.substring(1)
                        )
                        let urlQueryParam = currentUrlWithoutHash.searchParams
                        let isUrlHasIdQuery = urlQueryParam.has(TARGET_QUERY)
                        // abort if URL dont have ID query
                        if(!isUrlHasIdQuery) {
                            return
                        }
                        dd&&console.log('url has id')
                        let urlId = urlQueryParam.get(TARGET_QUERY)
                        let performDelayedScroll = function(){
                            // run delayed, to make sure everything loaded
                            setTimeout(function() {
                                dd&&console.log('will scroll to element now')
                                try{
                                    document.querySelector('#'+urlId)
                                        .scrollIntoView()
                                } catch(e){ dd&&console.log('custom scroll failed',e) }
                            }, SCROLL_DELAY);
                        }
                        // only scroll after browser tab focused
                        // @HACK: to handle url being opened on background tab
                        if(isBrowserTabFocused){
                            performDelayedScroll()
                            return
                        }
                        // if not focused, wait on focus
                        // @HACK: to handle url being opened on background tab
                        window.addEventListener('focus', function() {
                            browserTabFocusedCount++
                            dd&&console.log('browser tab is focused',browserTabFocusedCount)
                            let isBrowserFocusedFirstTime = browserTabFocusedCount<=1
                            if(!isBrowserFocusedFirstTime){
                                return
                            }
                            dd&&console.log('browser tab focused 1st time')
                            performDelayedScroll()
                        })
                    })
                },
                /**
                 * Custom plugin to inject LikeBtn on the bottom of ".markdown-section" element
                 * This will dynamically change the ID and re-init LikeBtn each page load
                 * ref: https://likebtn.com/en/faq#change_identifier
                 */
                function (hook, vm) {
                    let reInitLikeBtn = function(vm=vm,initBy="direct"){
                        let likeBtnSiteId = "5e37e9f3fa8fdf4161f15869";
                        let likeBtnSiteIdDev = "5e37e9f3fa8fdf4161f15869";
                        let isDevelopmentEnv = document.location.href.indexOf("://localhost") >= 0;
                        let labelBeforeLikeBtn = "Is this page helpful?";
                        let pageId = vm.route.path;
                        let likeBtnOutWrapperClass = "likebtn-outer-wrapper";
                        let likeBtnInWrapperClass = "likebtn-wrapper";
                        let docsifyContentWrapperSelector = ".markdown-section";
                        isDevelopmentEnv&&console.log("LikeBtn plugin is on dev env, id:",likeBtnSiteIdDev,"init by:",initBy);

                        isDevelopmentEnv&&console.log("initializing likebtn");
                        // remove last page LikeBtn element, if exist.
                        try{
                            document.querySelector("."+likeBtnOutWrapperClass).remove();
                        } catch(e) { };
                        // (re)inject LikeBtn element.
                        document.querySelector(docsifyContentWrapperSelector).innerHTML+=
                        `<div class="${likeBtnOutWrapperClass}" style="text-align:center; margin-bottom:1rem;">
                            <p><small>${labelBeforeLikeBtn}</small></p>
                            <span class="${likeBtnInWrapperClass}"
                                data-identifier="${pageId}"
                                data-site_id="${isDevelopmentEnv?likeBtnSiteIdDev:likeBtnSiteId}"
                                data-theme="elegant"
                                data-ef_voting="push"
                                data-show_like_label="false"
                                data-counter_type="percent"
                                data-counter_clickable="true"
                                data-share_size="small"
                                data-loader_show="true"
                                data-event_handler="likebtnCallback"
                                data-i18n_like_tooltip="Helpful"
                                data-i18n_dislike_tooltip="Not Helpful"
                                data-i18n_popup_close="Later"
                            \<\/span\>
                        \<\/div\>`;
                        // (re)init LikeBtn script for the new element.
                        LikeBtn.init();
                    }
                    // Trigger on each page load
                    hook.doneEach(function(){
                        if (typeof(LikeBtn) != "undefined") {
                            reInitLikeBtn(vm,"docsify-doneEach")
                        }
                    });
                    /* @NOTE: sometime LikeBtn script is on race condition with
                    * Docsify doneEach, if LikeBtn late to be loaded, init function
                    * doesn't get executed. Tried to handle it with `ready` hook.
                    */
                    // Trigger on first load, after docsify ready
                    hook.ready(function(){
                        if (typeof(LikeBtn) != "undefined") {
                            reInitLikeBtn(vm,"docsify-ready")
                        } else {
                            // retry after 2 second @OPTIMIZE the hardcoded 2 sec
                            setTimeout(function(){ reInitLikeBtn(vm,"delayed-ready") }, 2000);
                        }
                    });
                }
            ],
            // config for tabs plugin
            tabs: {
                persist    : true,      // default
                sync       : true,      // default
                theme      : 'classic', // default
                tabComments: true,      // default
                tabHeadings: true       // default
            },
            // config for themeable plugin
            themeable: {
                responsiveTables: false
            }
        }

        // Callback handler for LikeBtn
        // Prompt feedback popup on page getting like/dislike
        window.likebtnCallback = function (event) {
            let promptFeedback = function(){
                Swal.fire({
                    // title: '<strong>HTML <u>example</u></strong>',
                    icon: 'success',
                    html:`
<b>Thanks for your valuable feedback!</b>
<p>We always strive to improve. We appreciate your contribution to help us improve our service to you, we sincerely want to hear your thoughts!</p>
<hr>
<iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdaIKWnc4iKJKH2g2VgTWBYYxCRniZ6a5H_bmSbaLtztarn5Q/viewform?embedded=true" style="width:95%; height:65vh" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>
                    `,
                    showCloseButton: true,
                    showCancelButton: false,
                    showConfirmButton: false,
                    cancelButtonText:'Close',
                    width:600,
                })
            }
            if (event.type == "likebtn.like") {
                console.log("page liked");
                promptFeedback();
            }
            else if (event.type == "likebtn.dislike") {
                console.log("page disliked");
                promptFeedback();
            }
        }
    </script>
    <!-- SweetAlert library -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <!-- LikeBtn library -->
    <script>(function(d,e,s){if(d.getElementById("likebtn_wjs"))return;a=d.createElement(e);m=d.getElementsByTagName(e)[0];a.async=1;a.id="likebtn_wjs";a.src=s;m.parentNode.insertBefore(a, m)})(document,"script","//w.likebtn.com/js/w/widget.js");</script>
    <!-- Docsify library -->
    <script src="https://unpkg.com/docsify@4.9.4/lib/docsify.min.js"></script>
    <!-- Docsify plugins -->
    <script src="https://unpkg.com/docsify@4.9.4/lib/plugins/zoom-image.min.js"></script>
    <script src="https://unpkg.com/docsify@4.9.4/lib/plugins/emoji.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify@4/lib/plugins/search.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-themeable@0"></script>
    <script src="https://unpkg.com/docsify-pagination@2.4.0/dist/docsify-pagination.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-tabs@1"></script>
    <!-- Code highlighter language plugins -->
    <script src="https://unpkg.com/prismjs@1.17.1/components/prism-bash.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.17.1/components/prism-python.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.17.1/components/prism-go.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.17.1/components/prism-ruby.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.17.1/components/prism-php.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.17.1/components/prism-java.min.js"></script>
    <!-- @OPTIMIZE: add snap js only on certain page when needed? -->
    <script type="text/javascript"
    src="https://app.sandbox.midtrans.com/snap/snap.js"
    data-client-key="VT-client-yrHf-c8Sxr-ck8tx"></script>
    <!-- Style Switcher -->
    <script src="asset/style-switcher.js"></script>
</body>

</html>